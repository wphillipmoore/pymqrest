#!/usr/bin/env bash
set -euo pipefail

current_branch="$(git rev-parse --abbrev-ref HEAD)"

if [[ -z "$current_branch" || "$current_branch" == "HEAD" ]]; then
  echo "ERROR: unable to determine the current branch. Create a feature branch before committing." >&2
  exit 1
fi

case "$current_branch" in
  develop|release|main)
    echo "ERROR: direct commits to protected branches are forbidden ($current_branch)." >&2
    echo "Create a short-lived branch (feature/*, bugfix/*, hotfix/*) and open a PR." >&2
    exit 1
    ;;
esac

if [[ ! "$current_branch" =~ ^(feature|bugfix|hotfix|release|chore)/.+$ ]]; then
  echo "ERROR: branch '$current_branch' does not follow the required prefix rules." >&2
  echo "Allowed prefixes: feature/*, bugfix/*, hotfix/*, release/*, chore/*" >&2
  exit 1
fi
